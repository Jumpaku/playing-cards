{"version":3,"file":"index.bundle.js","sources":["js/errors/BaseError.js","js/errors/PanicError.js","js/errors/UnknownError.js","js/errors/utils.js","js/errors/TypeError.js","js/errors/IoError.js","js/errors/InitError.js","js/typing.js","js/env.js","js/rest/server.js","js/index.js"],"sourcesContent":["export class BaseError extends Error {\n    constructor(name, message, cause) {\n        super(message, { cause: cause });\n        this.name = name;\n        Error.captureStackTrace(this);\n    }\n    chainMessage() {\n        return chainMessageImpl(this).join(\" | \");\n    }\n    print(cerr = console.error) {\n        printErrImpl(this, cerr);\n    }\n    getInfo() {\n        return {};\n    }\n}\nfunction chainMessageImpl(err) {\n    if (err.cause instanceof Error) {\n        return [`${err.name}(${err.message})`, ...chainMessageImpl(err.cause)];\n    }\n    return [`${err.name}(${err.message})`, `${err.cause}`];\n}\nfunction printErrImpl(err, cerr) {\n    cerr(err);\n    if (err.cause == null) {\n        return;\n    }\n    if (!(err.cause instanceof Error)) {\n        cerr(err.cause);\n        return;\n    }\n    printErrImpl(err.cause, cerr);\n}\n","import { BaseError } from \"./BaseError\";\nexport class PanicError extends BaseError {\n    constructor(message, cause) {\n        super(\"PanicError\", message, cause);\n    }\n}\n","import { BaseError } from \"./BaseError\";\nexport class UnknownError extends BaseError {\n    constructor(cause) {\n        super(\"UnknownError\", cause != null ? \"error is wrapped\" : \"\", cause);\n    }\n}\n","import { exit } from \"process\";\nimport { BaseError } from \"./BaseError\";\nimport { PanicError } from \"./PanicError\";\nimport { UnknownError } from \"./UnknownError\";\nexport function panic(cause) {\n    if (!(cause instanceof BaseError)) {\n        panic(wrapErr(cause));\n    }\n    console.error(new PanicError(\"Panic!\", cause));\n    exit(1);\n}\nexport function wrapErr(err) {\n    if (err instanceof BaseError) {\n        return err;\n    }\n    if (err instanceof Error) {\n        return new UnknownError(err);\n    }\n    return new UnknownError(new Error(`${err}`, { cause: err }));\n}\n","import { BaseError } from \"./BaseError\";\nexport class TypeError extends BaseError {\n    constructor(message, cause) {\n        super(\"TypeError\", message, cause);\n    }\n}\n","import { BaseError } from \"./BaseError\";\nexport class IoError extends BaseError {\n    constructor(message, cause) {\n        super(\"IoError\", message, cause);\n    }\n}\n","import { BaseError } from \"./BaseError\";\nexport class InitError extends BaseError {\n    constructor(message, cause) {\n        super(\"InitError\", message, cause);\n    }\n}\n","import { TypeError, wrapErr } from \"./errors\";\nexport function validateType(type, obj) {\n    const r = type.decode(obj);\n    if (r._tag === \"Left\")\n        return [\n            null,\n            new TypeError(\"invalid type\", wrapErr(`[${r.left.map((e) => e.value).join(\",\")}]`)),\n        ];\n    return [r.right, null];\n}\n","import dotenv from \"dotenv\";\nimport types from \"io-ts\";\nimport { wrapErr, IoError } from \"./errors\";\nimport { validateType } from \"./typing\";\nexport const Env = types.type({\n    APP_STAGE: types.string,\n    APP_PORT: types.string,\n});\nexport function newEnv(path) {\n    const env = dotenv.config({ path });\n    if (env.error != null) {\n        return [\n            null,\n            new IoError(\"fail to load environment variables\", wrapErr(env.error)),\n        ];\n    }\n    const [val, err] = validateType(Env, env.parsed);\n    if (err != null) {\n        return [null, new IoError(`invalid environment variables`, err)];\n    }\n    return [val, null];\n}\n","import express from \"express\";\nexport function server() {\n    const app = express();\n    const port = 80;\n    app.get(\"/\", (req, res) => {\n        res.send(req.headers);\n    });\n    app.listen(port, () => {\n        console.log(`Example app listening on port ${port}`);\n    });\n}\n","import { newEnv } from \"./env\";\nimport { panic, InitError } from \"./errors\";\nimport { server } from \"./rest/server\";\nfunction main() {\n    console.log(\"hello\");\n    const [env, err] = newEnv(\".env\");\n    if (err != null) {\n        panic(new InitError(\"fail loading env\", err));\n    }\n    console.log(env);\n    server();\n}\nmain();\n"],"names":["exit"],"mappings":"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"}